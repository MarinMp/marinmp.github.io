# PL/SQL Scripts
Se incluirán procedimientos, funciones y triggers desarrollados en PL/SQL para automatizar procesos en bases de datos.

---

## Ejercicios Prácticos en Clase

### Modelo Relacional HR

![MODELO RELACIONAL](/PLSQL/hr-modelo-relacional.png)

---

### Consultas

```sql
-- Descripción: Habilita la salida de mensajes de DBMS_OUTPUT.PUT_LINE.

SET SERVEROUTPUT ON; 
```

#### Bloques anónimos

```sql
-- Bloque anónimo
-- Fecha: 13/02/2026
-- Descripción: Obtiene la fecha y hora actual del sistema.

DECLARE
    fecha timestamp;
BEGIN
    SELECT sysdate INTO fecha FROM dual;

    DBMS_OUTPUT.PUT_LINE('La fecha es: ' || fecha);
END;
```

```sql
-- Bloque anónimo
-- Fecha: 13/02/2026
-- Descripción: Obtiene el salario del empleado con ID 109 utilizando %TYPE.

DECLARE 
    v_salario HR.EMPLOYEES.SALARY%TYPE;
BEGIN
    SELECT SALARY INTO  v_salario
    FROM HR.EMPLOYEES
    WHERE EMPLOYEE_ID = 109;

    DBMS_OUTPUT.PUT_LINE('El salario es: ' || v_salario);
END;
```

```sql
-- Bloque anónimo
-- Fecha: 13/02/2026
-- Descripción: Obtiene el nombre, salario del empleado con ID 109 y su fecha de contratación utilizando %TYPE.

DECLARE 
    v_fecha_contratacion HR.EMPLOYEES.HIRE_DATE%TYPE;
    v_salario HR.EMPLOYEES.SALARY%TYPE;
    v_nombre HR.EMPLOYEES.FIRST_NAME%TYPE;
BEGIN
    SELECT SALARY, FIRST_NAME, HIRE_DATE INTO v_salario, v_nombre, v_fecha_contratacion
    FROM HR.EMPLOYEES
    WHERE EMPLOYEE_ID = 109;

    DBMS_OUTPUT.PUT_LINE('El nombre del empleado es: ' || v_nombre || ', su salario es: ' || v_salario || ' y la fecha de contratación es: ' || v_fecha_contratacion);
END;
```

```sql
-- Bloque anónimo
-- Fecha: 13/02/2026
-- Descripción: Obtiene el nombre, salario del empleado con ID 109 y su fecha de contratación utilizando %ROWTYPE.

DECLARE 
    v_empleado HR.EMPLOYEES%ROWTYPE;
BEGIN
    SELECT * INTO v_empleado
    FROM HR.EMPLOYEES
    WHERE EMPLOYEE_ID = 109;

    DBMS_OUTPUT.PUT_LINE('El nombre del empleado es: ' || v_empleado.FIRST_NAME || ', su salario es: ' || v_empleado.SALARY || ' y la fecha de contratación es: ' || v_empleado.HIRE_DATE);
END;
```

```sql
-- Bloque anónimo
-- Fecha: 13/02/2026
-- Descripción: Obtiene el nombre, salario del empleado con ID 109, su fecha de contratación y hace un cálculo adicional del salario usando la comisión (si existe; si no, toma 0 con NVL) utilizando %ROWTYPE.

DECLARE 
    v_empleado HR.EMPLOYEES%ROWTYPE;
BEGIN
    SELECT * INTO v_empleado
    FROM HR.EMPLOYEES
    WHERE EMPLOYEE_ID = 109;

    DBMS_OUTPUT.PUT_LINE('El nombre del empleado es: ' || v_empleado.FIRST_NAME || ', su salario es: ' || v_empleado.SALARY || ' y la fecha de contratación es: ' || v_empleado.HIRE_DATE || '. Por culpa del gobierno su salario es: ' || to_char(v_empleado.SALARY * NVL(v_empleado.commission.pct,0)));
END;
```

```sql
-- Bloque anónimo
-- Fecha: 16/02/2026
-- Descripción: Inserta en la tabla PAIS los registros de 198 países dentro de un bloque PL/SQL.

BEGIN
INSERT INTO PAIS VALUES (1,'AFGANISTÁN');
INSERT INTO PAIS VALUES (2,'ALBANIA');
INSERT INTO PAIS VALUES (3,'ALEMANIA');
INSERT INTO PAIS VALUES (4,'ANDORRA');
INSERT INTO PAIS VALUES (5,'ANGOLA');
INSERT INTO PAIS VALUES (6,'ANTIGUA Y BARBUDA');
INSERT INTO PAIS VALUES (7,'ARABIA SAUDITA');
INSERT INTO PAIS VALUES (8,'ARGELIA');
INSERT INTO PAIS VALUES (9,'ARGENTINA');
INSERT INTO PAIS VALUES (10,'ARMENIA');
INSERT INTO PAIS VALUES (11,'AUSTRALIA');
INSERT INTO PAIS VALUES (12,'AUSTRIA');
INSERT INTO PAIS VALUES (13,'AZERBAIYÁN');
INSERT INTO PAIS VALUES (14,'BAHAMAS');
INSERT INTO PAIS VALUES (15,'BANGLADÉS');
INSERT INTO PAIS VALUES (16,'BARBADOS');
INSERT INTO PAIS VALUES (17,'BARÉIN');
INSERT INTO PAIS VALUES (18,'BÉLGICA');
INSERT INTO PAIS VALUES (19,'BELICE');
INSERT INTO PAIS VALUES (20,'BENIN');
INSERT INTO PAIS VALUES (21,'BIELORRUSIA');
INSERT INTO PAIS VALUES (22,'BOLIVIA');
INSERT INTO PAIS VALUES (23,'BOSNIA Y HERZEGOVINA');
INSERT INTO PAIS VALUES (24,'BOTSUANA');
INSERT INTO PAIS VALUES (25,'BRASIL');
INSERT INTO PAIS VALUES (26,'BRUNEI');
INSERT INTO PAIS VALUES (27,'BULGARIA');
INSERT INTO PAIS VALUES (28,'BURKINA FASO');
INSERT INTO PAIS VALUES (29,'BURUNDI');
INSERT INTO PAIS VALUES (30,'BUTÁN');
INSERT INTO PAIS VALUES (31,'CABO VERDE');
INSERT INTO PAIS VALUES (32,'CAMBOYA');
INSERT INTO PAIS VALUES (33,'CAMERÚN');
INSERT INTO PAIS VALUES (34,'CANADÁ');
INSERT INTO PAIS VALUES (35,'CATAR');
INSERT INTO PAIS VALUES (36,'CHAD');
INSERT INTO PAIS VALUES (37,'CHILE');
INSERT INTO PAIS VALUES (38,'CHINA');
INSERT INTO PAIS VALUES (39,'CHIPRE');
INSERT INTO PAIS VALUES (40,'COLOMBIA');
INSERT INTO PAIS VALUES (41,'COMORAS');
INSERT INTO PAIS VALUES (42,'COREA DEL NORTE');
INSERT INTO PAIS VALUES (43,'COREA DEL SUR');
INSERT INTO PAIS VALUES (44,'COSTA DE MARFIL');
INSERT INTO PAIS VALUES (45,'COSTA RICA');
INSERT INTO PAIS VALUES (46,'CROACIA');
INSERT INTO PAIS VALUES (47,'CUBA');
INSERT INTO PAIS VALUES (48,'DINAMARCA');
INSERT INTO PAIS VALUES (49,'DOMINICA');
INSERT INTO PAIS VALUES (50,'ECUADOR');
INSERT INTO PAIS VALUES (51,'EGIPTO');
INSERT INTO PAIS VALUES (52,'EL SALVADOR');
INSERT INTO PAIS VALUES (53,'EMIRATOS ARABES UNIDOS');
INSERT INTO PAIS VALUES (54,'ERITREA');
INSERT INTO PAIS VALUES (55,'ESLOVAQUIA');
INSERT INTO PAIS VALUES (56,'ESLOVENIA');
INSERT INTO PAIS VALUES (57,'ESPAÑA');
INSERT INTO PAIS VALUES (58,'ESTADOS UNIDOS');
INSERT INTO PAIS VALUES (59,'ESTONIA');
INSERT INTO PAIS VALUES (60,'ETIOPÍA');
INSERT INTO PAIS VALUES (61,'FILIPINAS');
INSERT INTO PAIS VALUES (62,'FINLANDIA');
INSERT INTO PAIS VALUES (63,'FIYI');
INSERT INTO PAIS VALUES (64,'FRANCIA');
INSERT INTO PAIS VALUES (65,'GABÓN');
INSERT INTO PAIS VALUES (66,'GAMBIA');
INSERT INTO PAIS VALUES (67,'GEORGIA');
INSERT INTO PAIS VALUES (68,'GHANA');
INSERT INTO PAIS VALUES (69,'GRANADA');
INSERT INTO PAIS VALUES (70,'GRECIA');
INSERT INTO PAIS VALUES (71,'GUATEMALA');
INSERT INTO PAIS VALUES (72,'GUINEA');
INSERT INTO PAIS VALUES (73,'GUINEA ECUATORIAL');
INSERT INTO PAIS VALUES (74,'GUINEA-BISSAU');
INSERT INTO PAIS VALUES (75,'GUYANA');
INSERT INTO PAIS VALUES (76,'HAITÍ');
INSERT INTO PAIS VALUES (77,'HONDURAS');
INSERT INTO PAIS VALUES (78,'HUNGRÍA');
INSERT INTO PAIS VALUES (79,'INDIA');
INSERT INTO PAIS VALUES (80,'INDONESIA');
INSERT INTO PAIS VALUES (81,'IRÁN');
INSERT INTO PAIS VALUES (82,'IRAQ');
INSERT INTO PAIS VALUES (83,'IRLANDA');
INSERT INTO PAIS VALUES (84,'ISLANDIA');
INSERT INTO PAIS VALUES (85,'ISLAS MARSHALL');
INSERT INTO PAIS VALUES (86,'ISLAS SALOMÓN');
INSERT INTO PAIS VALUES (87,'ISRAEL');
INSERT INTO PAIS VALUES (88,'ITALIA');
INSERT INTO PAIS VALUES (89,'JAMAICA');
INSERT INTO PAIS VALUES (90,'JAPÓN');
INSERT INTO PAIS VALUES (91,'JORDANIA');
INSERT INTO PAIS VALUES (92,'KAZAJISTÁN');
INSERT INTO PAIS VALUES (93,'KENIA');
INSERT INTO PAIS VALUES (94,'KIRGUISTÁN');
INSERT INTO PAIS VALUES (95,'KIRIBATI');
INSERT INTO PAIS VALUES (96,'KUWAIT');
INSERT INTO PAIS VALUES (97,'LAOS');
INSERT INTO PAIS VALUES (98,'LESOTO');
INSERT INTO PAIS VALUES (99,'LETONIA');
INSERT INTO PAIS VALUES (100,'LÍBANO');
INSERT INTO PAIS VALUES (101,'LIBERIA');
INSERT INTO PAIS VALUES (102,'LIBIA');
INSERT INTO PAIS VALUES (103,'LIECHTENSTEIN');
INSERT INTO PAIS VALUES (104,'LITUANIA');
INSERT INTO PAIS VALUES (105,'LUXEMBURGO');
INSERT INTO PAIS VALUES (106,'MADAGASCAR');
INSERT INTO PAIS VALUES (107,'MALASIA');
INSERT INTO PAIS VALUES (108,'MALAUI');
INSERT INTO PAIS VALUES (109,'MALDIVAS');
INSERT INTO PAIS VALUES (110,'MALI');
INSERT INTO PAIS VALUES (111,'MALTA');
INSERT INTO PAIS VALUES (112,'MARRUECOS');
INSERT INTO PAIS VALUES (113,'MAURICIO');
INSERT INTO PAIS VALUES (114,'MAURITANIA');
INSERT INTO PAIS VALUES (115,'MÉXICO');
INSERT INTO PAIS VALUES (116,'MICRONESIA');
INSERT INTO PAIS VALUES (117,'MOLDAVIA');
INSERT INTO PAIS VALUES (118,'MÓNACO');
INSERT INTO PAIS VALUES (119,'MONGOLIA');
INSERT INTO PAIS VALUES (120,'MONTENEGRO');
INSERT INTO PAIS VALUES (121,'MOZAMBIQUE');
INSERT INTO PAIS VALUES (122,'MYANMAR (BIRMANIA)');
INSERT INTO PAIS VALUES (123,'NAMIBIA');
INSERT INTO PAIS VALUES (124,'NAURU');
INSERT INTO PAIS VALUES (125,'NEPAL');
INSERT INTO PAIS VALUES (126,'NICARAGUA');
INSERT INTO PAIS VALUES (127,'NÍGER');
INSERT INTO PAIS VALUES (128,'NIGERIA');
INSERT INTO PAIS VALUES (129,'NORUEGA');
INSERT INTO PAIS VALUES (130,'NUEVA ZELANDA');
INSERT INTO PAIS VALUES (131,'OMÁN');
INSERT INTO PAIS VALUES (132,'PAÍSES BAJOS');
INSERT INTO PAIS VALUES (133,'PAKISTÁN');
INSERT INTO PAIS VALUES (134,'PALAOS');
INSERT INTO PAIS VALUES (135,'PALESTINA');
INSERT INTO PAIS VALUES (136,'PANAMÁ');
INSERT INTO PAIS VALUES (137,'PAPÚA NUEVA GUINEA');
INSERT INTO PAIS VALUES (138,'PARAGUAY');
INSERT INTO PAIS VALUES (139,'PERÚ');
INSERT INTO PAIS VALUES (140,'POLONIA');
INSERT INTO PAIS VALUES (141,'PORTUGAL');
INSERT INTO PAIS VALUES (142,'PUERTO RICO');
INSERT INTO PAIS VALUES (143,'REINO UNIDO');
INSERT INTO PAIS VALUES (144,'REPÚBLICA CENTROAFRICANA');
INSERT INTO PAIS VALUES (145,'REPÚBLICA CHECA');
INSERT INTO PAIS VALUES (146,'REPÚBLICA DE MACEDONIA');
INSERT INTO PAIS VALUES (147,'REPÚBLICA DEL CONGO');
INSERT INTO PAIS VALUES (148,'REPÚBLICA DEMOCRÁTICA DEL CONGO');
INSERT INTO PAIS VALUES (149,'REPÚBLICA DOMINICANA');
INSERT INTO PAIS VALUES (150,'REPÚBLICA SAHARAUI');
INSERT INTO PAIS VALUES (151,'RUANDA');
INSERT INTO PAIS VALUES (152,'RUMANIA');
INSERT INTO PAIS VALUES (153,'RUSIA');
INSERT INTO PAIS VALUES (154,'SAMOA');
INSERT INTO PAIS VALUES (155,'SAN CRISTÓBAL Y NIEVES');
INSERT INTO PAIS VALUES (156,'SAN MARINO');
INSERT INTO PAIS VALUES (157,'SAN VICENTE Y LAS GRANADINAS');
INSERT INTO PAIS VALUES (158,'SANTA LUCÍA');
INSERT INTO PAIS VALUES (159,'SANTO TOMÉ Y PRÍNCIPE');
INSERT INTO PAIS VALUES (160,'SENEGAL');
INSERT INTO PAIS VALUES (161,'SERBIA');
INSERT INTO PAIS VALUES (162,'SEYCHELLES');
INSERT INTO PAIS VALUES (163,'SIERRA LEONA');
INSERT INTO PAIS VALUES (164,'SINGAPUR');
INSERT INTO PAIS VALUES (165,'SIRIA');
INSERT INTO PAIS VALUES (166,'SOMALIA');
INSERT INTO PAIS VALUES (167,'SRI LANKA');
INSERT INTO PAIS VALUES (168,'SUAZILANDIA');
INSERT INTO PAIS VALUES (169,'SUDÁFRICA');
INSERT INTO PAIS VALUES (170,'SUDÁN DEL NORTE');
INSERT INTO PAIS VALUES (171,'SUDÁN DEL SUR');
INSERT INTO PAIS VALUES (172,'SUECIA');
INSERT INTO PAIS VALUES (173,'SUIZA');
INSERT INTO PAIS VALUES (174,'SURINAM');
INSERT INTO PAIS VALUES (175,'TAILANDIA');
INSERT INTO PAIS VALUES (176,'TAIWAN');
INSERT INTO PAIS VALUES (177,'TANZANIA');
INSERT INTO PAIS VALUES (178,'TAYIKISTÁN');
INSERT INTO PAIS VALUES (179,'TIMOR ORIENTAL');
INSERT INTO PAIS VALUES (180,'TOGO');
INSERT INTO PAIS VALUES (181,'TONGA');
INSERT INTO PAIS VALUES (182,'TRINIDAD Y TOBAGO');
INSERT INTO PAIS VALUES (183,'TÚNEZ');
INSERT INTO PAIS VALUES (184,'TURKMENISTÁN');
INSERT INTO PAIS VALUES (185,'TURQUÍA');
INSERT INTO PAIS VALUES (186,'TUVALU');
INSERT INTO PAIS VALUES (187,'UCRANIA');
INSERT INTO PAIS VALUES (188,'UGANDA');
INSERT INTO PAIS VALUES (189,'URUGUAY');
INSERT INTO PAIS VALUES (190,'UZBEKISTÁN');
INSERT INTO PAIS VALUES (191,'VANUATU');
INSERT INTO PAIS VALUES (192,'VATICANO');
INSERT INTO PAIS VALUES (193,'VENEZUELA');
INSERT INTO PAIS VALUES (194,'VIETNAM');
INSERT INTO PAIS VALUES (195,'YEMEN');
INSERT INTO PAIS VALUES (196,'YIBUTI');
INSERT INTO PAIS VALUES (197,'ZAMBIA');
INSERT INTO PAIS VALUES (198,'ZIMBABUE');
END;
```

```sql
-- Bloque anónimo
-- Fecha: 16/02/2026
-- Descripción: Inserta en la tabla EQUIPO los registros de 24 equipos dentro de un bloque PL/SQL.

BEGIN
INSERT INTO EQUIPO VALUES (1,'Real Madrid',57);
INSERT INTO EQUIPO VALUES (2,'FC Barcelona',57);
INSERT INTO EQUIPO VALUES (3,'Atlético de Madrid',57);
INSERT INTO EQUIPO VALUES (4,'Manchester City',143);
INSERT INTO EQUIPO VALUES (5,'Liverpool FC',143);
INSERT INTO EQUIPO VALUES (6,'Arsenal FC',143);
INSERT INTO EQUIPO VALUES (7,'Manchester United',143);
INSERT INTO EQUIPO VALUES (8,'Chelsea FC',143);
INSERT INTO EQUIPO VALUES (9,'Bayern Múnich',3);
INSERT INTO EQUIPO VALUES (10,'Borussia Dortmund',3);
INSERT INTO EQUIPO VALUES (11,'AC Milan',88);
INSERT INTO EQUIPO VALUES (12,'Inter de Milán',88);
INSERT INTO EQUIPO VALUES (13,'Juventus',88);
INSERT INTO EQUIPO VALUES (14,'Paris Saint-Germain',64);
INSERT INTO EQUIPO VALUES (15,'Benfica',141);
INSERT INTO EQUIPO VALUES (16,'FC Porto',141);
INSERT INTO EQUIPO VALUES (17,'Ajax',132);
INSERT INTO EQUIPO VALUES (18,'Boca Juniors',9);
INSERT INTO EQUIPO VALUES (19,'River Plate',9);
INSERT INTO EQUIPO VALUES (20,'Flamengo',25);
INSERT INTO EQUIPO VALUES (21,'Palmeiras',25);
INSERT INTO EQUIPO VALUES (22,'Club América',115);
INSERT INTO EQUIPO VALUES (23,'Monterrey',115);
INSERT INTO EQUIPO VALUES (24,'America de Cali',40);
END;
```

```sql
-- Bloque anónimo
-- Fecha: 16/02/2026
-- Descripción: Trae el país que tenga más cantidad de equipos de fútbol.

DECLARE
   vv_pais PAIS.NOM_PAIS%TYPE;
BEGIN
  SELECT P.NOM_PAIS INTO vv_pais
FROM PAIS P
     INNER JOIN EQUIPO E
     ON P.COD_PAIS = E.COD_PAIS
GROUP BY P.NOM_PAIS
ORDER BY 1 DESC
FETCH FIRST 1 ROWS ONLY;
 
DBMS_OUTPUT.PUT_LINE('El país con más clubes es: ' || vv_pais);
END;
```

```sql
-- Bloque anónimo
-- Fecha: 16/02/2026
-- Descripción: Trae el país que tenga más cantidad de equipos de fútbol.

DECLARE
   vv_pais PAIS.NOM_PAIS%TYPE;
BEGIN
  SELECT P.NOM_PAIS INTO vv_pais
FROM PAIS P
     INNER JOIN EQUIPO E
     ON P.COD_PAIS = E.COD_PAIS
GROUP BY P.NOM_PAIS
ORDER BY 1 DESC
FETCH FIRST 1 ROWS ONLY;
 
DBMS_OUTPUT.PUT_LINE('El país con más clubes es: ' || vv_pais);
END;
```

#### Procedimientos almacenados (SP) 

```sql
-- Nombre SP: SP_ActualizaPais
-- Fecha: 16/02/2026
-- Descripción: Convierte a minúsculas el nombre de país y confirma la actualización mostrando un mensaje.

CREATE OR REPLACE 
PROCEDURE SP_ActualizaPais(vn_cod_pais IN  NUMBER)
IS
BEGIN
    UPDATE PAIS
    SET nom_pais = LOWER(nom_pais)
    WHERE COD_PAIS = vn_cod_pais;
    
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('Se actualizo el país: ' || TO_CHAR(vn_cod_pais));
    
END SP_ActualizaPais;
```