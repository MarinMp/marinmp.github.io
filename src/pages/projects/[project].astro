---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
    const projects = import.meta.glob('../../project-descriptions/*/descripcion.md');

    return Object.keys(projects).map(path => {
        const parts = path.split('/');
        const folder = parts[parts.length - 2];
        return {
            params: { project: folder }
        };
    });
}

const { project } = Astro.params;

// üî• Importamos markdown como componente
const esModules = import.meta.glob('../../project-descriptions/*/descripcion.md');
const enModules = import.meta.glob('../../project-descriptions/*/descripcion.en.md');

const esModule = await esModules[`../../project-descriptions/${project}/descripcion.md`]();
const enModule = await enModules[`../../project-descriptions/${project}/descripcion.en.md`]();

const ESContent = esModule.default;
const ENContent = enModule.default;

// Load images
const allImages = import.meta.glob('../../assets/*/*.{png,jpg,jpeg,webp}', { eager: true });
const projectImages = Object.keys(allImages)
    .filter(path => path.includes(`/${project}/`))
    .map(path => (allImages[path] as any).default.src);

const translations = {
    backToProjects: { en: '‚Üê Back to Evidences', es: '‚Üê Volver a Evidencias' },
    gallery: { en: 'Gallery', es: 'Galer√≠a' }
};
---

<Layout title={`${project} | Paula Mar√≠n`}>
	<Header />
	
	<main class="min-h-screen px-4 sm:px-6 md:px-6">
		<article class="max-w-3xl mx-auto pt-24 sm:pt-32 md:pt-48 pb-16 sm:pb-24 fade-in">
			
			<a 
				href="/projects" 
				class="text-sm font-medium text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors mb-8 inline-block"
			>
				{translations.backToProjects.en}
			</a>

			<!-- üî• Markdown renderizado con tu estilo -->
			<section class="space-y-6 text-gray-700 dark:text-gray-300 leading-relaxed">
				<div class="locale-es">
					<ESContent />
				</div>
				<div class="locale-en">
					<ENContent />
				</div>
			</section>

			<!-- Gallery -->
			{projectImages.length > 0 && (
				<section class="mt-16">
					<h2 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-6">
						{translations.gallery.en}
					</h2>

					<div class="grid grid-cols-1 gap-8">
						{projectImages.map((src) => (
							<div class="relative rounded-2xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900/50">
								<img src={src} alt="Project screenshot" class="w-full h-auto" loading="lazy" />
							</div>
						))}
					</div>
				</section>
			)}

		</article>
	</main>

	<Footer />

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			document.querySelector('.fade-in')?.classList.add('visible');
		});
	</script>
</Layout>

<style>
	@reference "../../styles/global.css";
</style>
